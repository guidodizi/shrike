
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.1.3">
    
    
      
        <title>Submission-time override - Shrike</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#submission-time-override" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Shrike" class="md-header__button md-logo" aria-label="Shrike" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Shrike
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Submission-time override
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/Azure/shrike/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Shrike" class="md-nav__button md-logo" aria-label="Shrike" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Shrike
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Azure/shrike/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Compliant Logging
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Compliant Logging" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Compliant Logging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../compliant_logging/" class="md-nav__link">
        Logging examples
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../compliant_logging/rfc-logging/" class="md-nav__link">
        Logging design
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../compliant_logging/aml-metrics-logging/" class="md-nav__link">
        Logging metrics in AML
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      <label class="md-nav__link" for="__nav_2_4">
        API reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../compliant_logging/constants/" class="md-nav__link">
        constants
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../compliant_logging/exceptions/" class="md-nav__link">
        exceptions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../compliant_logging/logging/" class="md-nav__link">
        logging
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Build
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Build" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Build
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../build/build-for-sign-and-register/" class="md-nav__link">
        Sign & register components
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rfc/strict-component-validation/" class="md-nav__link">
        Component validation
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        API reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../build/prepare/" class="md-nav__link">
        prepare
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../build/register/" class="md-nav__link">
        register
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Pipeline
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pipeline" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Pipeline
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../create-aml-pipeline/" class="md-nav__link">
        Create an AML pipeline
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../configure-aml-pipeline/" class="md-nav__link">
        Configure your AML pipeline
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reuse-aml-pipeline/" class="md-nav__link">
        Reuse your AML pipeline
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Submission-time override
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Submission-time override
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submission-time-override_1" class="md-nav__link">
    Submission-time override
  </a>
  
    <nav class="md-nav" aria-label="Submission-time override">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controlling-which-components-to-override" class="md-nav__link">
    Controlling which components to override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-tenant_overrides-section-to-your-pipeline-yaml" class="md-nav__link">
    Adding tenant_overrides section to your pipeline yaml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rfc/pipeline-image-override/" class="md-nav__link">
        Submission-time override (design)
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" type="checkbox" id="__nav_4_6" >
      
      <label class="md-nav__link" for="__nav_4_6">
        API reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline-config/" class="md-nav__link">
        pipeline_config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline-helper/" class="md-nav__link">
        pipeline_helper
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../module-helper/" class="md-nav__link">
        module_helper
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../canary-helper/" class="md-nav__link">
        canary_helper
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aml-connect/" class="md-nav__link">
        aml_connect
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing-components/" class="md-nav__link">
        testing.componets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing-importer/" class="md-nav__link">
        testing.importer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing-module-run-tests/" class="md-nav__link">
        testing.module_run_tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../testing-pipeline-class-test/" class="md-nav__link">
        testing.pipeline_class_test
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Spark
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Spark" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Spark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spark/examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      <label class="md-nav__link" for="__nav_5_2">
        API reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spark/spark_net/" class="md-nav__link">
        spark_net
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submission-time-override_1" class="md-nav__link">
    Submission-time override
  </a>
  
    <nav class="md-nav" aria-label="Submission-time override">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controlling-which-components-to-override" class="md-nav__link">
    Controlling which components to override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-tenant_overrides-section-to-your-pipeline-yaml" class="md-nav__link">
    Adding tenant_overrides section to your pipeline yaml
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Azure/shrike/edit/main/docs/pipeline/submission-time-override.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="submission-time-override">Submission-time override</h1>
<h2 id="motivation">Motivation</h2>
<p>A common scenario is when running experiments in different workspaces under different tenants, some fields need to changed accordingly, e.g. <code>tags</code> and docker base image. Internally at Microsoft, non-Heron workspaces do not have access to <a href="https://o365exchange.pkgs.visualstudio.com/_packaging/PolymerPythonPackages/pypi/simple/">Polymer Python Package Index</a>, and for Heron workspaces, base images are stored in different registries (<code>polymerprod.azurecr.io</code>, <code>polymerppe.azurecr.io</code>, <code>polymerdev.azurecr.io</code>) for different workspaces (e.g., <code>PROD</code>, <code>PPE</code>, <code>public eyes-on</code>). Users have to modify those fields manually when submitting experiments to a different workspace, which is not an optimal data science experience, and could easily lead to typos and errors.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>To enjoy this documentation, you should be familiar with <a href="../create-aml-pipeline/">how to create an AML pipeline</a> and <a href="../configure-aml-pipeline/">how to configure your AML pipeline</a>.</p>
<h2 id="submission-time-override_1">Submission-time override</h2>
<p>To allow components to operate across multiple workspaces, we now support submission time override, by which the corresponding fields are modified as user defined and reverted back after submission. The intial RFC (<strong>R</strong>equest <strong>F</strong>or <strong>C</strong>omment) can be found <a href="https://github.com/Azure/shrike/blob/main/docs/rfc/pipeline-image-override.md">here</a>.</p>
<h3 id="controlling-which-components-to-override">Controlling which components to override</h3>
<p>Only components using the "local" copy will be modified at submission time, so you need to define those components in <code>module_loader.use_local</code> or set it to <code>"*"</code>.</p>
<h3 id="adding-tenant_overrides-section-to-your-pipeline-yaml">Adding <code>tenant_overrides</code> section to your pipeline yaml</h3>
<p>With the additional code block <code>tenant_overrides</code>, when you submit an experiment, the <code>shrike.pipeline</code> package will check which tenant is being used, and performs the corresponding override.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nt">defaults</span><span class="p">:</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p p-Indicator">-</span> <span class="nt">aml</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eyesoff</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p p-Indicator">-</span> <span class="nt">compute</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eyesoff</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p p-Indicator">-</span> <span class="nt">modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">module_defaults</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="nt">run</span><span class="p">:</span>
<span class="linenos" data-linenos=" 7 "></span>  <span class="nt">experiment_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="linenos" data-linenos=" 8 "></span>  <span class="nt">tags</span><span class="p">:</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nt">accelerator_repo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="nt">module_loader</span><span class="p">:</span>
<span class="linenos" data-linenos="12 "></span>  <span class="nt">local_steps_folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">../../../components</span>
<span class="linenos" data-linenos="13 "></span>  <span class="nt">use_local</span><span class="p">:</span> <span class="s">&quot;*&quot;</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="c1">## Adding the following section for this new feature</span>
<span class="linenos" data-linenos="16 "></span><span class="nt">tenant_overrides</span><span class="p">:</span>
<span class="linenos" data-linenos="17 "></span>    <span class="nt">allow_override</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>    <span class="c1"># optional, default = false</span>
<span class="linenos" data-linenos="18 "></span>    <span class="nt">keep_modified_files</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>  <span class="c1"># optional, default = false</span>
<span class="linenos" data-linenos="19 "></span>    <span class="nt">mapping</span><span class="p">:</span>
<span class="linenos" data-linenos="20 "></span>        <span class="c1"># MSIT tenant</span>
<span class="linenos" data-linenos="21 "></span>        <span class="nt">72f988bf-86f1-41af-91ab-2d7cd011db47</span><span class="p">:</span>
<span class="linenos" data-linenos="22 "></span>            <span class="nt">remove_polymer_pkg_idx</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>    <span class="c1"># optional, default = false</span>
<span class="linenos" data-linenos="23 "></span>            <span class="nt">environment.docker.image</span><span class="p">:</span>
<span class="linenos" data-linenos="24 "></span>                <span class="nt">polymerprod.azurecr.io/polymercd/prod_official/azureml_base_gpu_openmpi312cuda101cudnn7</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mcr.microsoft.com/azureml/openmpi3.1.2-cuda10.1-cudnn7-ubuntu18.04</span>
<span class="linenos" data-linenos="25 "></span>                <span class="nt">polymerprod.azurecr.io/polymercd/prod_official/fake_image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mcr.microsoft.com/azureml/fake_image</span>
<span class="linenos" data-linenos="26 "></span>            <span class="nt">tags</span><span class="p">:</span>
<span class="linenos" data-linenos="27 "></span>                <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eyeson</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span>        <span class="nt">personal</span><span class="p">:</span> <span class="c1"># using file name to specify tenant instead of id</span>
<span class="linenos" data-linenos="30 "></span>            <span class="nt">environment.docker.image</span><span class="p">:</span>
<span class="linenos" data-linenos="31 "></span>                <span class="s">&#39;polymerprod.azurecr.io/polymercd/prod_official/(.+)&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;polymerdev.azurecr.io/polymercd/dev_official/\g&lt;1&gt;&#39;</span>
</code></pre></div>
Under <code>tenant_overrides</code>, you could specify three fields:
- <code>allow_override</code>: optional, set to <code>False</code> by default. This boolean controls whether the submission-time override functionality will be executed or not.
- <code>keep_modified_files</code>: optional, set to <code>False</code> by default. If <code>True</code>, then the modified files (<code>spec.yaml</code>, <code>env.yaml</code>, etc.) will be saved and renamed as <code>&lt;filename&gt;_&lt;tenant_id&gt;.&lt;extension&gt;</code>.
- <code>mapping</code>: (nested) dictionary-style definition. If this tenant is being used with <code>allow_override = True</code>, then all <strong>local</strong> components will be scanned and the matching fields defined in this <code>mapping</code> section will be changed.
    - Keys: <code>tenant_id</code> (e.g.: <code>72f988bf-86f1-41af-91ab-2d7cd011db47</code>) or "aml configuration" filename in <code>&lt;config-dir&gt;/aml</code> (which is also used as in <code>defaults: aml</code> in this yaml file).
    - Values: (nested) dictionaries, e.g. <code>environment.docker.image</code>. You could define the override for any field in <a href="https://componentsdk.azurewebsites.net/components.html">component schema</a>.
    - For string-type fields such as <code>environment.docker.image</code>, the override pattern is "old_value: new_value". For dict-type fields such as <code>tags</code>, the pattern is "key: new_value". In the example above, when running under MSIT tenant, the original spec.yaml with
    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">tags</span><span class="p">:</span>
<span class="linenos" data-linenos="2 "></span>    <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eyesoff</span>
</code></pre></div>
    will be overriden as 
    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">tags</span><span class="p">:</span>
<span class="linenos" data-linenos="2 "></span>    <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eyeson</span>
</code></pre></div>
    - The added code should be interpreted as a JSONPath expression, and both "naive" string substitution and regex-based substitution are allowed, e.g.:
    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="s">&#39;polymerprod.azurecr.io/polymercd/prod_official/(.+)&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;polymerdev.azurecr.io/polymercd/dev_official/\g&lt;1&gt;&#39;</span>
</code></pre></div>
    - <code>remove_polymer_pkg_idx</code>: in addition to fields defined in component schema, you could also define this boolean where the default value is <code>False</code>. If set to <code>True</code>, the index url "https://o365exchange.pkgs.visualstudio.com/_packaging/PolymerPythonPackages/pypi/simple/" will be removed from <code>environment.conda.conda_dependencies</code> or <code>conda_dependencies_file</code>.</p>
<h2 id="summary">Summary</h2>
<p>In short, to allow submission-time override, </p>
<ol>
<li>Add component keys or <code>"*"</code> to <code>module_loader.use_local</code></li>
<li>Add <code>tenant_overrides</code> section to pipeline yaml file, with<ul>
<li><code>allow_override: true</code></li>
<li>nested dictionary <code>mapping</code> with tenant_id or "aml configuration" filename as keys</li>
</ul>
</li>
<li>Submit your pipeline as usual. In your "snapshot" of the experiment on Azure ML portal, <code>component_spec.yaml</code> should be updated, while the original copies are renamed as <code>&lt;filename&gt;.not_used</code> (temporarily). The local filenames will be reverted. </li>
</ol>
<p>Example:
<center>
<img alt="image" src="../img/submission-time-override-original-code.png" /></p>
<p><em>Fig 1: original code structure on local machine</em></p>
<p><img alt="image" src="../img/submission-time-override-portal.png" /></p>
<p><em>Fig 2: Azure ML portal</em></p>
<p><img alt="image" src="../img/submission-time-override-modified.png" /></p>
<p><em>Fig 3: modified code after submission on local machine with <code>keep_modified_files</code> set to <code>False</code> (if <code>False</code>, it will be same as before submission)</em>
</center></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../reuse-aml-pipeline/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Reuse your AML pipeline
            </div>
          </div>
        </a>
      
      
        <a href="../../rfc/pipeline-image-override/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Submission-time override (design)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>